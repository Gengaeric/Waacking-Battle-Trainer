<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whacking Battle Trainer (Spotify)</title> <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#bb86fc">
</head>
<body>
    <div id="toast-container"></div>
    <div class="app-container">

        <h1 class="main-title">
            <img src="images/icon-192x192.png" alt="App Logo" class="title-logo">
            Whacking Battle Trainer
        </h1>
        <section class="info-panel">
            <button class="info-btn" data-modal="presentacion-modal">Presentaci√≥n</button>
            <button class="info-btn" data-modal="tutorial-modal">Tutorial de uso</button>
            <button class="info-btn" data-modal="contacto-modal">Contacto</button>
        </section>
        <div class="container">
            <section class="panel playlist-panel">
                <div class="saved-playlists-controls">
                    <h2><span class="icon">üíæ</span> Mis Playlists</h2>
                    <select id="saved-playlists-select"><option value="">Cargar una playlist...</option></select>
                    <button id="delete-playlist-btn" class="button secondary">Borrar Playlist Seleccionada</button>
                </div>
                <hr>
                <h2><span class="icon">‚ûï</span> Armar / Editar Playlist</h2>
                <div class="playlist-buttons">
                    <label for="add-mp3-input" class="button" style="display: none;">A√±adir Archivos MP3</label>
                    <input type="file" id="add-mp3-input" multiple accept="audio/*" style="display: none;">
                    <button id="add-youtube-btn" class="button" style="display: none;">A√±adir desde YouTube</button>
                    <button id="add-spotify-playlist-btn" class="button">A√±adir Playlist Spotify (Link)</button>
                    <button id="connect-spotify-btn" class="button">Conectar con Spotify</button>
                </div>
                <div class="current-playlist-management">
                    <h4>Gesti√≥n de la Lista Actual</h4>
                    <div class="playlist-name-group">
                        <input type="text" id="playlist-name-input" placeholder="Nombre para guardar">
                        <button id="save-playlist-btn" class="button primary">Guardar</button>
                    </div>
                    <button id="clear-playlist-btn" class="button secondary">Vaciar Lista</button>
                </div>
                <button id="toggle-playlist-btn" class="button secondary">Mostrar Lista (0)</button>
                <ul id="playlist-ul"></ul>
                 <div id="spotify-status" style="display: none; margin-top: 10px; text-align: center;">
                    Conectado como: <span id="spotify-user" style="font-weight: bold;"></span> <button id="disconnect-spotify-btn" class="button small danger">Desconectar</button>
                </div>
            </section>
            <section class="panel player-panel" id="player-panel">
                 <div id="welcome-message">
                     <h3>¬°Bienvenidxs!</h3>
                     <p style="text-align: center; line-height: 1.6;">Conecta tu cuenta y a√±ade playlists de Spotify para empezar.</p> <p style="text-align: center; font-size: 0.9em;">Usa los botones de arriba para ver la presentaci√≥n y el tutorial.</p>
                 </div>
                 <div id="player-controls" style="display: none;">
                     <div class="fixed-controls">
                        <h3 id="current-song-title"></h3>
                        <div id="countdown-display"></div>
                        <div class="controls-wrapper">
                            <button id="prev-btn" class="control-btn">‚èÆÔ∏è</button>
                            <button id="play-pause-btn" class="control-btn play-btn">‚ñ∂Ô∏è</button>
                            <button id="next-btn" class="control-btn">‚è≠Ô∏è</button>
                            <button id="toggle-video-btn" class="control-btn" title="Mostrar/Ocultar video" style="display: none;">üì∫</button>
                        </div>
                    </div>
                    <div id="youtube-player-container" style="display: none;"><div id="youtube-player"></div></div>
                    <div id="spotify-player-container" style="width: 100%; height: 80px; margin-top: 20px;"></div>
                 </div>
            </section>
            <section class="panel config-panel">
                <h2><span class="icon">‚öôÔ∏è</span> Configuraci√≥n</h2>
               <div class="config-group">
                   <label>Duraci√≥n del Round</label>
                   <div class="btn-group">
                       <button id="duration-40" class="config-btn active">40 seg</button>
                       <button id="duration-60" class="config-btn">1 min</button>
                   </div>
               </div>
               <div class="config-group">
                   <label for="segment-select">Segmento de Canci√≥n</label>
                   <select id="segment-select">
                       <option value="principio">Principio</option>
                       <option value="medio">Medio</option>
                       <option value="final">Final</option>
                       <option value="azar">Azar</option>
                   </select>
               </div>
               <div class="config-group">
                   <label for="gap-input">Pausa entre Canciones (seg)</label>
                   <input type="number" id="gap-input" value="3" min="0" max="10">
               </div>
               <div class="session-buttons">
                   <button id="start-session-btn">¬°COMENZAR SESI√ìN!</button>
                   <button id="end-session-btn" class="button danger">Finalizar Sesi√≥n</button>
               </div>
            </section>
        </div>
    </div>

    <div id="modal-overlay" class="hidden">
        <div id="presentacion-modal" class="modal hidden">
             <button class="close-modal-btn">√ó</button>
             <div class="modal-content">
                 <h2>Presentaci√≥n</h2>
                 <h4>Whacking Battle Trainer: Tu Sesi√≥n de Baile Automatizada.</h4>
                 <p>Esta es una aplicaci√≥n web dise√±ada para automatizar tus entrenamientos, replicando la sensaci√≥n de una batalla o un showcase. Te permite cargar tu m√∫sica, configurar los rounds y olvidarte del celular para concentrarte 100% en bailar.</p>
                 <hr>
                 <h4>Detalles Pensados para Bailarines:</h4>
                 <ul>
                     <li><b>Rounds a Medida:</b> Eleg√≠ la duraci√≥n de tus salidas (40 o 60 segundos) para practicar con los tiempos de una batalla real.</li>
                     <li><b>Pausa para Respirar:</b> Entre cada round, ten√©s unos segundos de pausa (que pod√©s configurar) para recuperar el aliento y prepararte para la siguiente canci√≥n.</li>
                     <li><b>Transiciones de DJ (Fade-In & Out):</b> La m√∫sica no te sorprende. Sube y baja suavemente al inicio y final de cada round, d√°ndote tiempo para empezar y terminar tu fraseo sin cortes bruscos.</li>
                     <li><b>Entrenamiento por Segmentos:</b> ¬øSiempre bail√°s los mismos 30 segundos de cada tema? Con las opciones de "Principio", "Medio" y "Final", pod√©s forzarte a entrenar con diferentes partes de las canciones.</li>
                     <li><b>Modo Azar Inteligente:</b> La opci√≥n "Azar" est√° dise√±ada para respetar la musicalidad. En vez de empezar en un segundo cualquiera, el sistema lo ajusta para que coincida con la estructura de la m√∫sica. La mayor√≠a de temas funk y disco de Whacking tienen un tempo ~120 BPM. Esto permite que haya m√°s posibilidades de que la canci√≥n arranque en el "1", el inicio de una frase musical, para que tu entrada sea siempre potente.</li>
                     <li><b>Cero Interrupciones (Pantalla Activa):</b> Al iniciar una sesi√≥n, la app evita que la pantalla de tu celular se apague. Tu √∫nica misi√≥n es bailar, sin tocar nada.</li>
                     <li><b>Flujo Ininterrumpido (Anti-Errores):</b> ¬øUn video de YouTube est√° protegido? La app te avisar√° con una notificaci√≥n que no detiene la m√∫sica y <strong>saltar√° autom√°ticamente al siguiente tema</strong>. El ritmo nunca para.</li>
                 </ul>
             </div>
         </div>
         <div id="tutorial-modal" class="modal hidden">
             <button class="close-modal-btn">√ó</button>
             <div class="modal-content">
                 <h2>Tutorial de uso</h2>
                 <h4>¬°Bienvenidxs al Trainer!</h4>
                 <p>Esta app est√° dise√±ada para que sus entrenamientos sean fluidos y enfocados. Aqu√≠ te explicamos c√≥mo funciona:</p>
                 <ol>
                     <li><strong>Carga tu M√∫sica:</strong> Presiona "A√±adir Playlist Spotify (Link)" y pega el enlace de la playlist que quieras usar. Necesitar√°s conectar tu cuenta de Spotify primero.</li> <li><strong>Guarda tu Playlist (Opcional):</strong> Si te gust√≥ la lista que armaste, ponele un nombre claro en el campo de "Nombre para guardar" y presion√° "Guardar". La pr√≥xima vez, podr√°s cargarla al instante desde el men√∫ "Mis Playlists".</li>
                     <li><strong>Configura tu Sesi√≥n y ¬°a Bailar!:</strong> En el panel de Configuraci√≥n, ajusta tu sesi√≥n. Cuando est√© todo listo, ¬°presion√° "¬°COMENZAR SESI√ìN!".</li>
                 </ol>
                 <hr>
                 <h4>Soluci√≥n a problemas comunes</h4>
                 <ul>
                     <li><b>"Spotify me dice que necesito Premium":</b> La reproducci√≥n dentro de la app requiere una cuenta Spotify Premium.</li>
                     <li><b>"No se carga la playlist de Spotify":</b> Aseg√∫rate de estar conectado a internet y de haber iniciado sesi√≥n con Spotify en la app. Verifica que el link sea correcto.</li>
                     <li><b>"No se escucha nada":</b> Revis√° que el volumen de 'multimedia' de tu celular no est√© en silencio.</li>
                 </ul>
             </div>
         </div>
         <div id="contacto-modal" class="modal hidden">
             <button class="close-modal-btn">√ó</button>
             <div class="modal-content">
                 <h2>Contacto</h2>
                 <h4>Hola, soy Eric</h4>
                 <p>Soy estudiante avanzado de Ciencias de la Educaci√≥n en la Universidad de San Andr√©s y whacker por hobby desde hace m√°s de 5 a√±os.</p>
                 <hr>
                 <h4>¬øPor qu√© cree esta herramienta?</h4>
                 <p>La primera vez que fui a una competencia de Whacking, me sent√≠ como si descubriera un mundo nuevo. La comunidad unida, la energ√≠a de divas y el amor por la danza de las batallas me dejaron una huella, y desde ah√≠ supe que quer√≠a dedicarme a entrenar para, alg√∫n d√≠a, poder competir.</p>
                 <p>El problema era que no siempre ten√≠a con qui√©n practicar; alguien que regulara el tiempo o cambiara las canciones para simular una batalla real y poder enfocarme en mis entradas. Como no s√© nada de programaci√≥n, empec√© a construirme esta aplicaci√≥n en un largo proceso de idas y vueltas con Gemini (la IA de Google). El resultado es esta herramienta, un "partner digital" que hoy me permite entrenar para una competencia en donde sea.</p>
                 <p>Mi objetivo con esta app es simple: compartirla de forma gratuita con todxs lxs whackers que la necesiten, para que puedan entrenar siempre que quieran.</p>
                 <hr>
                 <h4>¬øIdeas o Sugerencias?</h4>
                 <p>Si ten√©s alguna idea para mejorar la app o simplemente quer√©s conectar, pod√©s encontrarme en:</p>
                 <ul>
                    <li><strong>Instagram:</strong> <a href="https://www.instagram.com/Genga_eric" target="_blank" rel="noopener noreferrer">@Genga_eric</a></li>
                 </ul>
             </div>
         </div>
    </div>

    <audio id="sfx-player"></audio>

    <script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
    <script src="script.js"></script> <script src="https://sdk.scdn.co/spotify-player.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => console.log('SW Registrado')).catch(err => console.log('SW Error:', err));
            });
        }
    </script>
</body>
</html>
