<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whacking Battle Trainer (Spotify)</title> <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#bb86fc">
</head>
<body>
    <div id="toast-container"></div>
    <div class="app-container">
        <h1 class="main-title">
            <img src="images/icon-192x192.png" alt="App Logo" class="title-logo">
            Whacking Battle Trainer
        </h1>
        <div class="language-switcher" aria-label="Selector de idioma">
            <div class="language-group">
                <button class="language-btn" type="button" data-lang="es" aria-label="Espa√±ol">üá¶üá∑</button>
                <button class="language-btn" type="button" data-lang="en" aria-label="English">üá¨üáß</button>
            </div>
            <button id="restart-app-btn" class="restart-btn" type="button" data-i18n="restartApp" aria-label="Reiniciar app">Reiniciar app</button>
        </div>
        <section class="info-panel">
            <button class="info-btn" data-modal="presentacion-modal" data-i18n="infoPresentation">Presentaci√≥n</button>
            <button class="info-btn" data-modal="tutorial-modal" data-i18n="infoTutorial">Tutorial de uso</button>
            <button class="info-btn" data-modal="contacto-modal" data-i18n="infoContact">Contacto</button>
        </section>
        <div class="container">
            <section class="panel playlist-panel">
                <div class="saved-playlists-controls">
                    <h2><span class="icon">üéµ</span> <span data-i18n="myPlaylists">Cargar playlist</span></h2>
                </div>
                <div class="playlist-buttons">
                    <label for="add-mp3-input" class="button" style="display: none;" data-i18n="addMp3">A√±adir Archivos MP3</label>
                    <input type="file" id="add-mp3-input" multiple accept="audio/*" style="display: none;">
                    <button id="add-youtube-btn" class="button" data-i18n="addYoutube">A√±adir desde YouTube</button>
                    <button id="add-spotify-playlist-btn" class="button" data-i18n="addSpotifyPlaylist">A√±adir desde Spotify</button>
                    <button id="connect-spotify-btn" class="button" data-i18n="connectSpotify">Conectar con Spotify</button>
                </div>
                <div class="playlist-source-selector">
                    <label for="playlist-source-select" data-i18n="currentPlaylistSource">Origen de la playlist actual</label>
                    <select id="playlist-source-select">
                        <option value="spotify" data-i18n="playlistSourceSpotify">Spotify</option>
                        <option value="youtube" data-i18n="playlistSourceYoutube">YouTube</option>
                    </select>
                    <p class="config-helper" data-i18n="currentPlaylistSourceHelper">
                        Elige el correcto para que funcione.
                    </p>
                </div>
                <button id="toggle-playlist-btn" class="button secondary" data-i18n="showList">Mostrar Lista (0)</button>
                <ul id="playlist-ul"></ul>
                <div class="playlist-status">
                    <span id="playlist-progress">0/0</span>
                    <span id="session-timer">00:00</span>
                </div>
                 <div id="spotify-status" style="display: none; margin-top: 10px; text-align: center;">
                    <span data-i18n="connectedAs">Conectado como:</span> <span id="spotify-user" style="font-weight: bold;"></span> <button id="disconnect-spotify-btn" class="button small danger" data-i18n="disconnect">Desconectar</button>
                </div>
            </section>
            <section class="panel player-panel" id="player-panel">
                 <div id="welcome-message">
                     <h3 data-i18n="welcomeTitle">¬°Bienvenidxs!</h3>
                     <p style="text-align: center; line-height: 1.6;" data-i18n="welcomeText">Conecta tu cuenta y a√±ade playlists de Spotify para empezar.</p> <p style="text-align: center; font-size: 0.9em;" data-i18n="welcomeHint">Usa los botones de arriba para ver la presentaci√≥n y el tutorial.</p>
                 </div>
                 <div id="player-controls" style="display: none;">
                     <div class="fixed-controls">
                        <h3 id="current-song-title"></h3>
                        <div id="countdown-display"></div>
                        <div class="controls-wrapper">
                            <button id="prev-btn" class="control-btn">‚èÆÔ∏è</button>
                            <button id="play-pause-btn" class="control-btn play-btn">‚ñ∂Ô∏è</button>
                            <button id="next-btn" class="control-btn">‚è≠Ô∏è</button>
                            <button id="toggle-video-btn" class="control-btn" title="Mostrar/Ocultar video" style="display: none;" data-i18n-title="toggleVideoTitle">üì∫</button>
                        </div>
                    </div>
                    <div id="youtube-player-container" style="display: none;"><div id="youtube-player"></div></div>
                    <div id="spotify-player-container" style="width: 100%; height: 80px; margin-top: 20px;"></div>
                 </div>
            </section>
            <section class="panel config-panel">
                <h2><span class="icon">‚öôÔ∏è</span> <span data-i18n="configTitle">Configuraci√≥n</span></h2>
               <div class="config-group">
                   <label data-i18n="roundDuration">Duraci√≥n del Round</label>
                   <div class="btn-group">
                       <button id="duration-40" class="config-btn active" data-i18n="duration40">40 seg</button>
                       <button id="duration-60" class="config-btn" data-i18n="duration60">1 min</button>
                   </div>
               </div>
               <div class="config-group">
                   <label data-i18n="trainingMode">Modo de entrenamiento</label>
                   <div class="btn-group">
                       <button id="train-partner-no" class="config-btn active" data-i18n="trainingSolo">Solitario</button>
                       <button id="train-partner-yes" class="config-btn" data-i18n="trainingPartner">Con alguien</button>
                   </div>
               </div>
               <div class="config-group">
                   <label for="segment-select" data-i18n="songSegment">Segmento de Canci√≥n</label>
                   <select id="segment-select">
                       <option value="principio" data-i18n="segmentStart">Principio</option>
                       <option value="medio" data-i18n="segmentMiddle">Medio</option>
                       <option value="final" data-i18n="segmentEnd">Final</option>
                       <option value="azar" data-i18n="segmentRandom">Azar</option>
                   </select>
                  <p class="config-helper" data-i18n="segmentHelper">
                      En modo ‚ÄúCon alguien‚Äù, el segmento se reproduce dos veces antes de pasar al siguiente tema.
                  </p>
               </div>
               <div class="config-group">
                   <label data-i18n="playbackOrder">Orden de Reproducci√≥n</label>
                   <div class="btn-group">
                       <button id="order-sequential" class="config-btn active" data-i18n="orderSequential">En orden</button>
                       <button id="order-random" class="config-btn" data-i18n="orderRandom">Al azar</button>
                   </div>
               </div>
               <div class="config-group">
                   <label for="gap-input" data-i18n="gapBetweenSongs">Pausa entre Canciones (seg)</label>
                   <input type="number" id="gap-input" value="3" min="0" max="10">
               </div>
               <div class="session-buttons">
                   <button id="start-session-btn" data-i18n="startSession">¬°COMENZAR SESI√ìN!</button>
                   <button id="end-session-btn" class="button danger" data-i18n="endSession">Finalizar Sesi√≥n</button>
               </div>
            </section>
        </div>
    </div>

    <div id="modal-overlay" class="hidden">
         <div id="presentacion-modal" class="modal hidden">
             <button class="close-modal-btn">√ó</button>
             <div class="modal-content">
                 <h2 data-i18n="modalPresentationTitle">Presentaci√≥n</h2>
                 <h4 data-i18n="modalPresentationSubtitle">Whacking Battle Trainer: Tu Sesi√≥n de Baile Automatizada.</h4>
                 <p data-i18n="presentationIntro">Esta es una aplicaci√≥n web dise√±ada para automatizar tus entrenamientos, replicando la sensaci√≥n de una batalla o un showcase. Te permite cargar tu m√∫sica, configurar los rounds y olvidarte del celular para concentrarte 100% en bailar.</p>
                 <hr>
                 <h4 data-i18n="presentationDetails">Detalles Pensados para Bailarines:</h4>
                 <ul>
                     <li data-i18n-html="presentationRound"><b>Rounds a Medida:</b> Eleg√≠ la duraci√≥n de tus salidas (40 o 60 segundos) para practicar con los tiempos de una batalla real.</li>
                     <li data-i18n-html="presentationPause"><b>Pausa para Respirar:</b> Entre cada round, ten√©s unos segundos de pausa (que pod√©s configurar) para recuperar el aliento y prepararte para la siguiente canci√≥n.</li>
                     <li data-i18n-html="presentationTransitions"><b>Transiciones de DJ (Fade-In & Out):</b> La m√∫sica no te sorprende. Sube y baja suavemente al inicio y final de cada round, d√°ndote tiempo para empezar y terminar tu fraseo sin cortes bruscos.</li>
                     <li data-i18n-html="presentationSegments"><b>Entrenamiento por Segmentos:</b> ¬øSiempre bail√°s los mismos 30 segundos de cada tema? Con las opciones de "Principio", "Medio" y "Final", pod√©s forzarte a entrenar con diferentes partes de las canciones.</li>
                     <li data-i18n-html="presentationSmartRandom"><b>Modo Azar Inteligente:</b> La opci√≥n "Azar" est√° dise√±ada para respetar la musicalidad. En vez de empezar en un segundo cualquiera, el sistema lo ajusta para que coincida con la estructura de la m√∫sica. La mayor√≠a de temas funk y disco de Whacking tienen un tempo ~120 BPM. Esto permite que haya m√°s posibilidades de que la canci√≥n arranque en el "1", el inicio de una frase musical, para que tu entrada sea siempre potente.</li>
                    <li data-i18n-html="presentationInstantResponse"><b>Respuesta Instant√°nea (Modo de entrenamiento):</b> Si eleg√≠s ‚ÄúCon alguien‚Äù, cada canci√≥n suena en dos segmentos seguidos. Despu√©s del primer conteo de 5 beeps, la m√∫sica sigue sin fade-out para que la otra persona responda al instante. Al terminar el segundo segmento, vuelven los beeps, hay fade-out y reci√©n ah√≠ se cambia de tema. Esto recrea la autenticidad de una batalla real.</li>
                    <li data-i18n-html="presentationFocus"><b>Claridad de enfoque:</b> En ‚ÄúSolitario‚Äù, cada tema se reproduce una sola vez para que puedas concentrarte en tu salida y la musicalidad sin cortes extra.</li>
                     <li data-i18n-html="presentationNoInterruptions"><b>Cero Interrupciones (Pantalla Activa):</b> Al iniciar una sesi√≥n, la app evita que la pantalla de tu celular se apague. Tu √∫nica misi√≥n es bailar, sin tocar nada.</li>
                     <li data-i18n-html="presentationFlow"><b>Flujo Ininterrumpido (Anti-Errores):</b> ¬øUn video de YouTube est√° protegido? La app te avisar√° con una notificaci√≥n que no detiene la m√∫sica y <strong>saltar√° autom√°ticamente al siguiente tema</strong>. El ritmo nunca para.</li>
                 </ul>
             </div>
         </div>
         <div id="tutorial-modal" class="modal hidden">
             <button class="close-modal-btn">√ó</button>
             <div class="modal-content">
                 <h2 data-i18n="modalTutorialTitle">Tutorial de uso</h2>
                 <h4 data-i18n="modalTutorialSubtitle">¬°Bienvenidxs al Trainer!</h4>
                 <p data-i18n="tutorialIntro">Esta app est√° dise√±ada para que sus entrenamientos sean fluidos y enfocados. Aqu√≠ te explicamos c√≥mo funciona:</p>
                 <ol>
                     <li data-i18n-html="tutorialStep1"><strong>Carga tu M√∫sica:</strong> Presiona "A√±adir desde Spotify" y pega el enlace de la playlist que quieras usar. Necesitar√°s conectar tu cuenta de Spotify primero.</li> <li data-i18n-html="tutorialStep2"><strong>Guarda tu Playlist (Opcional):</strong> Si te gust√≥ la lista que armaste, ponele un nombre claro en el campo de "Nombre para guardar" y presion√° "Guardar". La pr√≥xima vez, podr√°s cargarla al instante desde el men√∫ "Cargar playlist".</li>
                     <li data-i18n-html="tutorialStep3"><strong>Configura tu Sesi√≥n y ¬°a Bailar!:</strong> En el panel de Configuraci√≥n, ajusta tu sesi√≥n. Cuando est√© todo listo, ¬°presion√° "¬°COMENZAR SESI√ìN!".</li>
                 </ol>
                 <hr>
                 <h4 data-i18n="tutorialTroubleshoot">Soluci√≥n a problemas comunes</h4>
                 <ul>
                     <li data-i18n-html="tutorialIssuePremium"><b>"Spotify me dice que necesito Premium":</b> La reproducci√≥n dentro de la app requiere una cuenta Spotify Premium.</li>
                     <li data-i18n-html="tutorialIssuePlaylist"><b>"No se carga la playlist de Spotify":</b> Aseg√∫rate de estar conectado a internet y de haber iniciado sesi√≥n con Spotify en la app. Verifica que el link sea correcto.</li>
                     <li data-i18n-html="tutorialIssueAudio"><b>"No se escucha nada":</b> Revis√° que el volumen de 'multimedia' de tu celular no est√© en silencio.</li>
                 </ul>
             </div>
         </div>
         <div id="contacto-modal" class="modal hidden">
             <button class="close-modal-btn">√ó</button>
             <div class="modal-content">
                 <h2 data-i18n="modalContactTitle">Contacto</h2>
                <h4 data-i18n="contactSubtitle">Hola, soy Eric (a.k.a. Genga)</h4>
                <p data-i18n-html="contactIntro">Soy estudiante avanzado de Ciencias de la Educaci√≥n en la Universidad de San Andr√©s y miembro oficial de la crew <a href="https://www.instagram.com/waackerangers/" target="_blank" rel="noopener noreferrer">@waackerangers</a> ‚ö°</p>
                 <hr>
                 <h4 data-i18n="contactWhyTitle">¬øPor qu√© cree esta herramienta?</h4>
                 <p data-i18n="contactWhyParagraph1">La primera vez que fui a una competencia de Whacking, me sent√≠ como si descubriera un mundo nuevo. La comunidad unida, la energ√≠a de divas y el amor por la danza de las batallas me dejaron una huella, y desde ah√≠ supe que quer√≠a dedicarme a entrenar para, alg√∫n d√≠a, poder competir.</p>
                 <p data-i18n="contactWhyParagraph2">El problema era que no siempre ten√≠a con qui√©n practicar; alguien que regulara el tiempo o cambiara las canciones para simular una batalla real y poder enfocarme en mis entradas. Como no s√© nada de programaci√≥n, empec√© a construirme esta aplicaci√≥n en un largo proceso de idas y vueltas con Gemini (la IA de Google). El resultado es esta herramienta, un "partner digital" que hoy me permite entrenar para una competencia en donde sea.</p>
                 <p data-i18n="contactWhyParagraph3">Mi objetivo con esta app es simple: compartirla de forma gratuita con todxs lxs whackers que la necesiten, para que puedan entrenar siempre que quieran.</p>
                 <hr>
                 <h4 data-i18n="contactIdeasTitle">¬øIdeas o Sugerencias?</h4>
                 <p data-i18n="contactIdeasText">Si ten√©s alguna idea para mejorar la app o simplemente quer√©s conectar, pod√©s encontrarme en:</p>
                 <ul>
                    <li data-i18n-html="contactInstagram"><strong>Instagram:</strong> <a href="https://www.instagram.com/Genga_eric" target="_blank" rel="noopener noreferrer">@Genga_eric</a></li>
                 </ul>
             </div>
         </div>
    </div>

    <audio id="sfx-player"></audio>

    <script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="script.js"></script> <script src="https://sdk.scdn.co/spotify-player.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => console.log('SW Registrado')).catch(err => console.log('SW Error:', err));
            });
        }
    </script>
</body>
</html>
